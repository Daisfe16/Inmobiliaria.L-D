@model InmobiliariaMVC.Models.Pago
@{
    ViewBag.Title = "Detalle del Pago";
    bool isAdmin = User.IsInRole("Admin");
}

<h2>Detalle del Pago</h2>

<div class="card">
    <div class="card-body">
        <p><strong>Contrato:</strong> @Model.Contrato?.id_contrato</p>
        <p><strong>Inquilino:</strong> @Model.Contrato?.Inquilino?.nombre @Model.Contrato?.Inquilino?.apellido</p>
        <p><strong>Inmueble:</strong> @Model.Contrato?.Inmueble?.direccion</p>
        <p><strong>Nro de pago:</strong> @Model.nro_pago</p>
        <p><strong>Fecha:</strong> @Model.fecha.ToString("dd/MM/yyyy")</p>
        <p><strong>Detalle:</strong> @Model.detalle</p>
        <p><strong>Importe:</strong> @Model.importe.ToString("C")</p>
        <p><strong>Estado:</strong> @(Model.estado ? "Activo" : "Anulado")</p>

        @* Auditoría visible solo para admin *@
        @if (isAdmin)
        {
            <hr />
            <h5>Auditoría</h5>
            <p><strong>Creado por:</strong> @Model.CreatedByUser?.nombre @Model.CreatedByUser?.apellido</p>
            <p><strong>Fecha de creación:</strong> @(Model.CreatedAt?.ToString("dd/MM/yyyy HH:mm") ?? "")</p>
            <p><strong>Cerrado por:</strong> @Model.ClosedByUser?.nombre @Model.ClosedByUser?.apellido</p>
            <p><strong>Fecha de cierre:</strong> @(Model.ClosedAt?.ToString("dd/MM/yyyy HH:mm") ?? "")</p>
        }
    </div>
</div>

<div class="mt-3">
    <a class="btn btn-secondary" href="@Url.Action("Index", "Pagos")">Volver a la lista</a>
    @if(Model.estado)
    {
        <a class="btn btn-primary" href="@Url.Action("Edit", "Pagos", new { id = Model.id_pago })">Editar Detalle</a>
        <a class="btn btn-danger" href="@Url.Action("Cerrar", "Pagos", new { id = Model.id_pago })">Anular Pago</a>
    }
</div>
